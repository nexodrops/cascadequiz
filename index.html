<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cascade Quiz â€” 50 questions</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <style>
    :root{
      --bg-main:#0e1118;
      --card-bg:#0f1620;
      --accent-cyan:#22d3ee;
      --accent-mint:#4ade80;
      --text-light:#f1f3f5;
      --text-muted:#8a8f99;
      --border:#232a32;
      --radius:14px;
      --trans:0.28s ease;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      background:var(--bg-main);
      color:var(--text-light);
      font-family:'Poppins',system-ui,Segoe UI,Arial;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      padding:20px;
    }
    .container{
      width:100%;
      max-width:920px;
      background:var(--card-bg);
      border-radius:var(--radius);
      overflow:hidden;
      box-shadow:0 18px 40px rgba(0,0,0,.6);
    }

    .topbar {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px 18px;
      background:linear-gradient(90deg,var(--accent-cyan),var(--accent-mint));
    }
    .brand { display:flex; gap:12px; align-items:center; cursor:pointer; user-select:none; }
    .brand img { height:40px; width:auto; display:block; }
    .title { line-height:1; display:flex; flex-direction:column; gap:8px; }
    .title h1{ font-size:1.25rem; margin:0; color:#012; font-weight:800; letter-spacing:0.2px; }
    .title p{ margin:0; color:#012; font-size:0.82rem; font-weight:600; opacity:0.95; }

    .toplink a{
      display:inline-block;
      padding:8px 10px;
      border-radius:8px;
      background:rgba(1,34,41,0.06);
      color:#012;
      font-weight:700;
      text-decoration:none;
    }

    .header{
      padding:18px 22px;
      text-align:center;
      background:linear-gradient(180deg, rgba(2,34,41,0.04), transparent);
    }
    .header h1{ font-size:1.6rem; margin:0; color:var(--text-light); letter-spacing:0.4px; }
    .header p{ margin-top:8px; color:var(--text-muted); }

    .section{ padding:20px; display:none; }
    .section.active{ display:block; animation:fadeIn .32s var(--trans); }
    @keyframes fadeIn{ from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:none} }

    .intro { text-align:center; margin-bottom:12px; }
    .intro h2{ font-size:1.4rem; margin-bottom:8px; }
    .intro p{ color:var(--text-muted); max-width:820px; margin:0 auto 18px; line-height:1.5 }

    .levels{ display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-bottom:14px;}
    .level-btn{
      padding:9px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);
      background:transparent;color:var(--text-light);cursor:pointer;font-weight:600;
      transition:all .15s ease;
    }
    .level-btn.sel{ background:linear-gradient(90deg,var(--accent-cyan),var(--accent-mint)); color:#012; border:none; }

    .btn{
      padding:12px 26px; border-radius:12px; border:none; cursor:pointer; font-weight:700;
      background:linear-gradient(90deg,var(--accent-cyan),var(--accent-mint)); color:#012;
      transition:transform 0.15s ease, box-shadow 0.15s ease, opacity 0.12s ease;
      will-change: transform;
    }
    .btn.small{ padding:8px 12px; font-size:0.95rem }
    .btn.ghost{ background:transparent;border:1px solid rgba(255,255,255,0.08); color:var(--text-light); }
    .btn.primary-highlight{
      box-shadow:0 8px 24px rgba(34,211,238,0.12), 0 4px 12px rgba(74,222,128,0.06);
      transform:translateY(-1px);
    }

    .btn:active { transform: scale(0.96); opacity:0.98; }

    .loader{ display:flex; justify-content:center; align-items:center; height:120px; }
    .loader span{ width:12px;height:12px;border-radius:50%;display:inline-block;margin:0 6px;background:var(--accent-cyan); animation:bounce .6s infinite alternate;}
    .loader span:nth-child(2){ animation-delay:.12s }
    .loader span:nth-child(3){ animation-delay:.24s }
    @keyframes bounce{ to{ transform:translateY(-12px); opacity:.6 } }

    .question-counter{ text-align:center;color:var(--text-muted); margin-bottom:12px }
    .progress-bar{ width:100%;height:10px;background:var(--border);border-radius:8px;overflow:hidden;margin-bottom:14px}
    .progress-fill{ height:100%; width:0%; background:linear-gradient(90deg,var(--accent-cyan),var(--accent-mint)); transition:width var(--trans) }

    .question-card{ background:transparent;padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03); margin-bottom:14px }
    .question-card h3{ font-size:1.15rem; color:var(--text-light); margin-bottom:12px }

    .options{ display:grid; gap:12px }
    .option{
      padding:12px 14px;border-radius:10px;background:#11161b;border:2px solid #1f262b;color:var(--text-light);
      cursor:pointer; transition:transform .18s ease, border-color .18s ease, background .18s ease, box-shadow .12s ease;
      user-select:none;
    }
    .option:hover{ transform:translateY(-4px); border-color:var(--accent-mint) }
    .option.correct{ border-color:#51cf66; background:rgba(81,207,102,0.08) }
    .option.incorrect{ border-color:#f03e3e; background:rgba(240,62,62,0.06) }

    .controls{
      display:flex;
      gap:6px;
      justify-content:center;
      margin-top:8px;
    }

    .results{ text-align:center; padding:20px 24px }
    .results .score{ font-size:3rem; margin:10px 0; background:linear-gradient(90deg,var(--accent-cyan),var(--accent-mint)); -webkit-background-clip:text; -webkit-text-fill-color:transparent }
    .results .message{ color:var(--text-light); margin-bottom:6px }
    .results .detail{ color:var(--text-muted); margin-top:0; margin-bottom:12px }

    .aggregate{
      padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03); margin:10px 0; background:linear-gradient(180deg, rgba(2,34,41,0.02), transparent)
    }
    .agg-table{ width:100%; border-collapse:collapse; margin-top:8px }
    .agg-table th, .agg-table td{ text-align:left; padding:8px 10px; color:var(--text-light); border-bottom:1px solid rgba(255,255,255,0.03) }
    .agg-table th{ color:var(--text-muted); font-weight:600; font-size:0.95rem }

    .footer{ padding:12px 18px; text-align:center; color:var(--text-muted); background:var(--card-bg) }

    @media(max-width:680px){
      .brand img{height:30px}
      .title h1{ font-size:1.05rem; }
      .header h1{ font-size:1.35rem }
      .btn{ padding:10px 20px }
      .agg-table th, .agg-table td{ font-size:0.92rem }
    }
  </style>

  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div class="brand" id="brandBtn" title="Go to Home">
        <img src="glider_logo.png" alt="Glider logo" />
        <div class="title">
          <h1 id="brandTitle">Cascade Quiz</h1>
          <p id="brandSubtitle">50 questions â€” 5 levels (Beginner â†’ Expert)</p>
        </div>
      </div>
      <div class="toplink"><a href="https://cascade.xyz/" target="_blank" rel="noopener">Open Cascade</a></div>
    </div>

    <div class="header">
      <h1 id="headerTitle">Cascade Knowledge Challenge</h1>
      <p id="headerDesc"></p>
    </div>

    <!-- START -->
    <div id="start" class="section active">
      <div class="intro">
        <h2>Choose a level</h2>
        <p>Select a level below â€” each level contains 10 questions. </p>
      </div>

      <div class="levels" id="levels">
        <button class="level-btn sel" data-level="Beginner">Beginner</button>
        <button class="level-btn" data-level="Novice">Novice</button>
        <button class="level-btn" data-level="Intermediate">Intermediate</button>
        <button class="level-btn" data-level="Advanced">Advanced</button>
        <button class="level-btn" data-level="Expert">Expert</button>
      </div>

      <div style="text-align:center;margin-bottom:8px">
        <button id="startBtn" class="btn">Start Quiz (Beginner)</button>
      </div>
    </div>

    <!-- LOADING -->
    <div id="loading" class="section">
      <div class="loader"><span></span><span></span><span></span></div>
      <p style="text-align:center;color:var(--text-muted);margin-top:8px">Preparing questionsâ€¦</p>
    </div>

    <!-- QUIZ -->
    <div id="quiz" class="section">
      <div class="question-counter"><span id="cur">1</span> / <span id="tot">10</span></div>
      <div class="progress-bar"><div id="fill" class="progress-fill"></div></div>

      <div class="question-card">
        <h3 id="qtext">Question</h3>
        <div class="options" id="opts"></div>
      </div>

      <div class="controls">
        <button class="btn ghost" id="endBtn">End Early</button>
        <button class="btn" id="nextBtn" disabled>Next</button>
      </div>
    </div>

    <!-- PER-LEVEL RESULTS -->
    <div id="results" class="section">
      <div class="results">
        <div class="score" id="finalPct">0%</div>
        <div class="message" id="finalMsg">Message</div>

        <div style="max-width:420px;margin:10px auto">
          <canvas id="resultChart" width="420" height="320"></canvas>
        </div>

        <p style="color:var(--text-muted)">Correct: <span id="finalCorrect">0</span> | Wrong: <span id="finalWrong">0</span> | Total: <span id="finalTot">10</span></p>

        <div style="text-align:center;margin-top:12px">
          <button id="playAgain" class="btn ghost">Play Again </button>
          <button id="goHome" class="btn primary-highlight small" style="margin-left:8px">Next Level</button>
        </div>
      </div>
    </div>

    <!-- AGGREGATE FINAL -->
    <div id="aggregate" class="section">
      <div class="aggregate">
        <h2 style="margin:0 0 8px 0">Final Summary â€” All Levels Completed</h2>
        <p style="margin:0 0 12px 0;color:var(--text-muted)">Nice! You completed all 5 levels. Below is your combined performance.</p>

        <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between">
          <div>
            <div style="font-size:2.25rem;font-weight:700;color:var(--text-light)" id="aggPercent">0%</div>
            <div style="color:var(--text-muted);margin-top:6px" id="aggMessage">Message</div>
          </div>
          <div style="text-align:right">
            <div style="color:var(--text-muted)">Total correct</div>
            <div style="font-size:1.5rem;font-weight:700" id="aggCorrect">0 / 50</div>
          </div>
        </div>

        <table class="agg-table" aria-hidden="false">
          <thead>
            <tr><th>Level</th><th>Correct</th><th>Wrong</th></tr>
          </thead>
          <tbody id="aggBody">
          </tbody>
        </table>

        <div style="margin-top:14px;text-align:center">
          <button id="resetAll" class="btn">Restart All </button>
          <button id="chooseLevelAfter" class="btn ghost small" style="margin-left:8px">Next Level</button>
        </div>
      </div>
    </div>

    <div class="footer">
      Created by <a href="https://x.com/nexodrops" target="_blank" rel="noopener" style="color:var(--accent-mint);text-decoration:none;margin-left:6px;">@nexodrops</a>
    </div>
  </div>

  <script>
    // DEFAULT HEADER DESCRIPTION â€” shown ONLY on start/home
    const DEFAULT_HEADER_DESC = 'Test your knowledge on Cascade â€” unified margin trading, perps, equities & private markets';

    const QUIZ = {
  "Beginner": [
    { q: "What is Cascade primarily designed to be?", o: ["A centralized crypto exchange","A 24/7 neo-brokerage with unified margin","A DeFi lending protocol","An NFT marketplace"], c: 1 },
    { q: "Which asset types does Cascade aim to support in one account?", o: ["Only crypto spot","Crypto perps only","Crypto, US equities, and private markets","Only forex"], c: 2 },
    { q: "What does 'unified margin' mean on Cascade?", o: ["Separate balances per market","One balance shared across all instruments","Only USDC margin","Manual collateral transfers"], c: 1 },
    { q: "Is Cascade designed to operate 24/7?", o: ["No, equities hours only","Yes, across supported markets","Only on weekends","Only crypto hours"], c: 1 },
    { q: "Which user group is Cascade mainly built for?", o: ["Only institutions","Retail traders only","Both retail and advanced traders","Banks only"], c: 2 },
    { q: "Does Cascade require users to manage multiple accounts?", o: ["Yes","No, single account","Only for equities","Only for crypto"], c: 1 },
    { q: "Which collateral is commonly referenced for pre-deposits?", o: ["ETH","BTC","USDC / fiat","Stable NFTs"], c: 2 },
    { q: "What happens to funds deposited before launch?", o: ["Immediately tradable","Locked until trading goes live","Burned","Auto-staked"], c: 1 },
    { q: "Why are users incentivized to pre-deposit?", o: ["Free leverage","Cascade Points","Guaranteed profits","Token airdrop only"], c: 1 },
    { q: "Cascade combines which markets under one interface?", o: ["Only DeFi","CeFi + DeFi","Crypto + TradFi style markets","Only prediction markets"], c: 2 }
  ],

  "Novice": [
    { q: "What type of trading does Cascade emphasize?", o: ["Spot only","Perpetuals and derivatives","NFT flipping","Mining"], c: 1 },
    { q: "How does Cascade simplify multi-market exposure?", o: ["Manual transfers","Unified margin engine","Separate wallets","Bridges"], c: 1 },
    { q: "What is a major UX benefit of Cascade?", o: ["Email trading","One account for all assets","No KYC ever","Unlimited leverage"], c: 1 },
    { q: "Which fiat rails are referenced for deposits?", o: ["Wire only","Stripe / ACH","Cash only","PayPal"], c: 1 },
    { q: "What happens if users withdraw too early after launch?", o: ["Nothing","Lose some or all points","Get bonus points","Trading disabled forever"], c: 1 },
    { q: "What is CLS in Cascade context?", o: ["Collateral Lock System","Cascade Liquidity Strategy","Central Limit Service","Crypto Lending Scheme"], c: 1 },
    { q: "Why is CLS attractive?", o: ["High leverage","Points accumulation","Instant arbitrage","NFT rewards"], c: 1 },
    { q: "Cascade aims to reduce what common trader pain point?", o: ["Price discovery","Fragmented accounts","Gas fees only","Charting tools"], c: 1 },
    { q: "Which users benefit most from unified margin?", o: ["Passive holders","Active multi-asset traders","Miners","Validators"], c: 1 },
    { q: "Does Cascade focus only on crypto-native assets?", o: ["Yes","No, includes traditional-style assets","Only NFTs","Only memecoins"], c: 1 }
  ],

  "Intermediate": [
    { q: "What risk does unified margin introduce?", o: ["No risk","Cross-asset liquidation risk","Only spot risk","No liquidation"], c: 1 },
    { q: "Why is margin efficiency important?", o: ["Lower UI load","Capital optimization","More tokens","Better charts"], c: 1 },
    { q: "Cascade positions itself closest to which model?", o: ["DEX aggregator","Neo-brokerage","Prediction market","AMM"], c: 1 },
    { q: "Why is 24/7 access important for equities-style assets?", o: ["Speculation","Global market access","Mining rewards","Staking yield"], c: 1 },
    { q: "What does Cascade abstract away from users?", o: ["Market risk","Account fragmentation","Trading fees","Price volatility"], c: 1 },
    { q: "Which strategy benefits most from unified collateral?", o: ["Single spot buys","Multi-asset hedging","NFT minting","Yield farming"], c: 1 },
    { q: "Why are points systems often used pre-launch?", o: ["Immediate profit","Liquidity bootstrapping","Price fixing","Governance votes"], c: 1 },
    { q: "Cascade reduces friction between which markets?", o: ["NFT and gaming","Crypto and traditional assets","Options and futures only","Mining and staking"], c: 1 },
    { q: "What happens post-launch to locked funds?", o: ["Permanent lock","Gradual unlock after period","Burn","Convert to token"], c: 1 },
    { q: "Who is CLS NOT ideal for?", o: ["Long-term believers","Liquidity providers","Short-term exit seekers","Early supporters"], c: 2 }
  ],

  "Advanced": [
    { q: "Unified margin increases which systemic risk?", o: ["Gas risk","Correlation risk","UI risk","Oracle risk only"], c: 1 },
    { q: "Why is cross-asset liquidation complex?", o: ["Different volatility profiles","UI lag","API limits","Chart delays"], c: 0 },
    { q: "What does Cascade attempt to unify?", o: ["Only UI","Execution + collateral","Governance","Tokenomics"], c: 1 },
    { q: "Why is capital efficiency critical for pro traders?", o: ["Lower fees","More optionality","Less charts","Faster UI"], c: 1 },
    { q: "What makes Cascade different from typical CEXs?", o: ["More pairs","Neo-brokerage structure","NFT focus","Mining support"], c: 1 },
    { q: "What is the main trade-off of unified margin?", o: ["Lower returns","Shared liquidation risk","No leverage","More KYC"], c: 1 },
    { q: "CLS points reward which behavior?", o: ["High-frequency trading","Early committed liquidity","Late deposits","NFT trading"], c: 1 },
    { q: "Why lockups matter in incentive programs?", o: ["Prevent farming abuse","Increase gas","Reduce users","Delay launch"], c: 0 },
    { q: "Cascade aims to compete with what legacy model?", o: ["Retail banks","Traditional brokerages","DEXs only","Prediction markets"], c: 1 },
    { q: "Who benefits most from Cascade long-term?", o: ["Casual traders","Multi-market power users","Miners","NFT artists"], c: 1 }
  ],

  "Expert": [
    { q: "Unified margin systems require what to be robust?", o: ["UI design","Risk engine","Social signals","Token price"], c: 1 },
    { q: "What is the biggest failure mode of poor margin design?", o: ["Slow charts","Cascade liquidations","Email lag","Wrong branding"], c: 1 },
    { q: "Why is margin correlation modeling important?", o: ["Price prediction","Prevent cascading liquidations","Marketing","UX testing"], c: 1 },
    { q: "CLS primarily aligns incentives between?", o: ["Users and whales","Platform and early liquidity","Traders and miners","NFT creators"], c: 1 },
    { q: "Why does Cascade delay withdrawals post-launch?", o: ["Compliance","Stability during price discovery","UI testing","KYC checks"], c: 1 },
    { q: "Which traders gain edge from unified collateral?", o: ["Directional traders","Cross-market hedgers","NFT flippers","Spot beginners"], c: 1 },
    { q: "What does Cascade abstract similar to Robinhood-style UX?", o: ["Risk","Execution complexity","Fees","Leverage"], c: 1 },
    { q: "Why is a neo-brokerage model powerful in crypto?", o: ["Regulation","Asset convergence","Speculation","Mining"], c: 1 },
    { q: "What is the long-term vision of Cascade?", o: ["Single exchange","Universal trading account","NFT hub","DEX aggregator"], c: 1 },
    { q: "Cascade fundamentally bets on what trend?", o: ["Meme cycles","Financial market convergence","Mining dominance","NFT royalties"], c: 1 }
  ]
};

    // Fisherâ€“Yates shuffle
    function shuffleArray(arr){
      for(let i = arr.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // App state
    const LEVELS = ["Beginner","Novice","Intermediate","Advanced","Expert"];
    let currentLevel = "Beginner";
    let questions = [];
    let qidx = 0;
    let correctCount = 0;

    const levelResults = { "Beginner": null, "Novice": null, "Intermediate": null, "Advanced": null, "Expert": null };

    // DOM refs
    const levelsEl = document.getElementById('levels');
    const startBtn = document.getElementById('startBtn');
    const nextBtn = document.getElementById('nextBtn');
    const endBtn = document.getElementById('endBtn');
    const playAgainBtn = document.getElementById('playAgain');
    const goHomeBtn = document.getElementById('goHome');

    // brand/header refs
    const brandBtn = document.getElementById('brandBtn');
    const headerTitle = document.getElementById('headerTitle');
    const headerDesc = document.getElementById('headerDesc');

    const aggBody = document.getElementById('aggBody');
    const aggPercent = document.getElementById('aggPercent');
    const aggCorrect = document.getElementById('aggCorrect');
    const aggMessage = document.getElementById('aggMessage');
    const resetAllBtn = document.getElementById('resetAll');
    const chooseLevelAfter = document.getElementById('chooseLevelAfter');

    // NOTE: headerDesc is intentionally empty by default. We'll set it only for start & results.
    function updateHeaderTitle(activeSectionId){
      if(activeSectionId === 'start'){
        headerTitle.textContent = 'Glider IQ Challenge';
        headerDesc.textContent = DEFAULT_HEADER_DESC; // show only on home
      } else if(activeSectionId === 'quiz'){
        headerTitle.textContent = currentLevel + ' Level';
        headerDesc.textContent = ''; // empty elsewhere
      } else if(activeSectionId === 'results'){
        headerTitle.textContent = currentLevel + ' Results';
        // <-- show per-level "Your performance..." HERE (right under the Results header)
        headerDesc.textContent = `Your performance for the ${currentLevel} level.`;
      } else if(activeSectionId === 'aggregate'){
        headerTitle.textContent = 'Final Summary';
        headerDesc.textContent = '';
      } else {
        headerTitle.textContent = 'Glider IQ Challenge';
        headerDesc.textContent = '';
      }
    }

    // level selection
    levelsEl.addEventListener('click', (e)=>{
      const btn = e.target.closest('.level-btn');
      if(!btn) return;
      document.querySelectorAll('.level-btn').forEach(b=>b.classList.remove('sel'));
      btn.classList.add('sel');
      currentLevel = btn.dataset.level;
      startBtn.textContent = `Start Quiz (${currentLevel})`;
      updateHeaderTitle('start');
    });

    // brand click => home
    brandBtn.addEventListener('click', () => {
      showSection('start');
      document.querySelectorAll('.level-btn').forEach(b=> b.classList.toggle('sel', b.dataset.level === currentLevel));
      startBtn.textContent = `Start Quiz (${currentLevel})`;
    });

    // start quiz
    startBtn.addEventListener('click', ()=>{
      showSection('loading');
      setTimeout(()=>{
        showSection('quiz');
        startLevel(currentLevel);
      }, 350);
    });

    function startLevel(level){
      document.querySelectorAll('.level-btn').forEach(b=> b.classList.toggle('sel', b.dataset.level === level));
      questions = QUIZ[level].map(q => ({ q: q.q, o: q.o.slice(), c: q.c }));
      qidx = 0; correctCount = 0;
      document.getElementById('tot').textContent = questions.length;
      currentLevel = level;
      updateHeaderTitle('quiz');
      loadQuestion();
    }

    function loadQuestion(){
      if(qidx >= questions.length) return showResultsForCurrentLevel();
      const q = questions[qidx];
      document.getElementById('cur').textContent = qidx+1;
      document.getElementById('qtext').textContent = q.q;

      // prepare option objects with original index preserved, then shuffle for display
      const optObjs = q.o.map((txt, idx) => ({ txt, orig: idx }));
      shuffleArray(optObjs);

      const opts = document.getElementById('opts');
      opts.innerHTML = '';

      optObjs.forEach(optObj => {
        const d = document.createElement('div');
        d.className = 'option';
        d.textContent = optObj.txt;
        d.dataset.orig = optObj.orig; // store original index to validate against q.c
        d.addEventListener('click', ()=> chooseOption(d));
        opts.appendChild(d);
      });

      const pct = Math.round((qidx)/questions.length*100);
      document.getElementById('fill').style.width = pct + '%';
      nextBtn.disabled = true;
    }

    // ORIG-based validation (robust with shuffle)
    function chooseOption(el){
      const q = questions[qidx];
      const chosenOrig = Number(el.dataset.orig);

      // prevent double clicks
      const first = document.querySelectorAll('.option')[0];
      if(first && first.style.pointerEvents === 'none') return;

      document.querySelectorAll('.option').forEach(n=>{
        n.style.pointerEvents = 'none';
        const nOrig = Number(n.dataset.orig);
        if(nOrig === q.c) n.classList.add('correct');
        else if(nOrig === chosenOrig && chosenOrig !== q.c) n.classList.add('incorrect');
      });

      if(chosenOrig === q.c){
        correctCount++;
        if(window.confetti) confetti({ particleCount: 48, spread: 50, origin: { y: 0.6 } });
      }

      nextBtn.disabled = false;
    }

    nextBtn.addEventListener('click', ()=>{
      qidx++;
      loadQuestion();
    });

    endBtn.addEventListener('click', ()=> showResultsForCurrentLevel());

    function showResultsForCurrentLevel(){
      levelResults[currentLevel] = correctCount;

      const total = questions.length || 10;
      const wrong = total - correctCount;
      const pct = total ? Math.round((correctCount/total)*100) : 0;

      document.getElementById('finalPct').textContent = pct + '%';
      document.getElementById('finalCorrect').textContent = correctCount;
      document.getElementById('finalWrong').textContent = wrong;

      document.getElementById('finalMsg').textContent =
        pct>=80 ? 'ðŸ† Excellent â€” you know this level well!' :
        pct>=60 ? 'ðŸ‘ Good job â€” solid understanding!' :
        pct>=40 ? 'ðŸ‘ Keep learning â€” you are getting there!' :
        'ðŸ’ª Keep practising â€” read the docs and try again!';

      renderChart(correctCount, wrong);

      // style buttons for results
      playAgainBtn.className = 'btn ghost';
      goHomeBtn.className = 'btn primary-highlight small';

      const allAttempted = LEVELS.every(l => levelResults[l] !== null);
      if(allAttempted){
        showSection('results');
        updateHeaderTitle('results');
        setTimeout(()=> showAggregateSummary(), 700);
      } else {
        showSection('results');
        updateHeaderTitle('results');
      }
    }

    // start next level helper
    function startNextLevelFrom(current){
      const idx = LEVELS.indexOf(current);
      const nextIdx = idx + 1;
      if(nextIdx < LEVELS.length){
        const next = LEVELS[nextIdx];
        playAgainBtn.className = 'btn';
        goHomeBtn.className = 'btn ghost small';
        showSection('quiz');
        startLevel(next);
      } else {
        playAgainBtn.className = 'btn';
        goHomeBtn.className = 'btn ghost small';
        showSection('start');
        updateHeaderTitle('start');
      }
    }

    goHomeBtn.addEventListener('click', ()=>{
      startNextLevelFrom(currentLevel);
    });

    // aggregate summary
    function showAggregateSummary(){
      let totalCorrect = 0;
      const rows = [];
      LEVELS.forEach(l => {
        const correct = levelResults[l] ?? 0;
        totalCorrect += correct;
        rows.push({ level: l, correct, wrong: 10 - correct });
      });

      const pct = Math.round((totalCorrect / (LEVELS.length * 10)) * 100);

      aggBody.innerHTML = '';
      rows.forEach(r => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${r.level}</td><td>${r.correct} / 10</td><td>${r.wrong}</td>`;
        aggBody.appendChild(tr);
      });

      aggPercent.textContent = pct + '%';
      aggCorrect.textContent = `${totalCorrect} / ${LEVELS.length * 10}`;

      let msg = '';
      if(pct === 100){
        msg = 'ðŸ† Perfect â€” you aced every question. Incredible work!';
      } else if(pct >= 90){
        msg = 'ðŸ”¥ Amazing â€” almost flawless. A little more practice and it\'s perfect!';
      } else if(pct >= 75){
        msg = 'Great job! You have strong knowledge across levels.';
      } else if(pct >= 50){
        msg = 'Nice effort â€” solid foundation. Review weak spots and try again.';
      } else {
        msg = 'Good start â€” keep learning and come back. Practice consistently!';
      }
      aggMessage.textContent = msg;

      playAgainBtn.className = 'btn';
      goHomeBtn.className = 'btn ghost small';

      showSection('aggregate');
      updateHeaderTitle('aggregate');
    }

    // reset
    resetAllBtn.addEventListener('click', ()=>{
      for(const k of LEVELS) levelResults[k] = null;
      playAgainBtn.className = 'btn';
      goHomeBtn.className = 'btn ghost small';
      showSection('start');
      updateHeaderTitle('start');
    });

    chooseLevelAfter.addEventListener('click', ()=>{
      playAgainBtn.className = 'btn';
      goHomeBtn.className = 'btn ghost small';
      showSection('start');
      updateHeaderTitle('start');
    });

    // play again
    playAgainBtn.addEventListener('click', ()=>{
      startLevel(currentLevel);
      playAgainBtn.className = 'btn';
      goHomeBtn.className = 'btn ghost small';
    });

    // chart
    let chartInst = null;
    function renderChart(corr, wrong){
      const ctx = document.getElementById('resultChart').getContext('2d');
      if(chartInst) chartInst.destroy();
      chartInst = new Chart(ctx, {
        type:'doughnut',
        data:{
          labels:['Correct','Wrong'],
          datasets:[{
            data:[corr, wrong],
            backgroundColor:['#51cf66','#f03e3e'],
            hoverOffset:8
          }]
        },
        options:{
          cutout:'72%',
          plugins:{ legend:{ position:'bottom', labels:{ color: getComputedStyle(document.documentElement).getPropertyValue('--text-light').trim() } } }
        }
      });
    }

    function showSection(id){
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      const el = document.getElementById(id);
      if(el) el.classList.add('active');
      updateHeaderTitle(id);
    }

    // init
    showSection('start');

    // expose for quick debugging
    window._QUIZ = QUIZ;
    window._levelResults = levelResults;
  </script>
</body>
</html>
